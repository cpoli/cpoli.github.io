

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>chain_tb &mdash; chain_tb  documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
    <link rel="top" title="chain_tb  documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index_chain.html" class="fa fa-home"> chain_tb</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#motivations">Motivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#feedback">Feedback</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../code.html">Code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../code.html#chain-tb">chain_tb</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples_1.html">Zero modes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples_1.html#identical-hoppings-with-an-impurity">Identical hoppings with an impurity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples_1.html#alternating-hoppings">Alternating hoppings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples_1.html#dimerization-defect">Dimerization defect</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples_2.html">PT-symmetry / PT-symmetry breaking</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples_2.html#dimer">Dimer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples_2.html#dimer-chain">Dimer chain</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index_chain.html">chain_tb</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index_chain.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>chain_tb</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for chain_tb</h1><div class="highlight"><pre>
<span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    chain_tb</span>
<span class="sd">    ~~~~~~~~</span>
<span class="sd">    </span>
<span class="sd">    The **chain_tb** package models a one-dimensional tight-binding dimer chain</span>
<span class="sd">    with real and/or complex valued hoppings and onsite energies.</span>
<span class="sd">    Defects can be introduced by locally modifying the on-site energies</span>
<span class="sd">    and/or the hoppings.</span>
<span class="sd">    </span>
<span class="sd">    **chain_tb** is available at https://github.com/cpoli/chain_tb</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="kn">as</span> <span class="nn">sparse</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="kn">as</span> <span class="nn">LA</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cm</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">import</span> <span class="nn">os</span>


<div class="viewcode-block" id="chain_tb"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb">[docs]</a><span class="k">class</span> <span class="nc">chain_tb</span><span class="p">:</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    This is the only class of the **chain_tb** module which contains all</span>
<span class="sd">    information for the one dimensional tight-binding model.</span>

<span class="sd">    :param sites: Number of sites of the chain (positive integer).</span>
<span class="sd">    :param ta: Intradimer coupling, connects the A sites to the B sites.</span>
<span class="sd">    :param tb: Interdimer coupling, connects the B sites to the A sites.</span>
<span class="sd">    :param ea: Default value 0. Onsite energies of the A sites.</span>
<span class="sd">    :param eb: Default value 0. Onsite energies of the B sites.</span>
<span class="sd">    :param ext: Default value &#39;png&#39;. Extension of the figures to be saved.</span>

<span class="sd">    ::</span>
<span class="sd">        </span>
<span class="sd">        # Examples</span>
<span class="sd">        # Creates a chain monomer with identical hoppings:</span>
<span class="sd">        ch = chain_tb(sites=22, ta=2., tb=2.)</span>
<span class="sd">        # Creates a chain with n sites and alternating hoppings:</span>
<span class="sd">        ch = chain_tb(sites=21, ta=2+0.5j, tb=1-1j, ea=1+1j, eb=1-1j)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sites</span><span class="p">,</span> <span class="n">ta</span><span class="p">,</span> <span class="n">tb</span><span class="p">,</span> <span class="n">ea</span><span class="o">=</span><span class="mi">0j</span><span class="p">,</span> <span class="n">eb</span><span class="o">=</span><span class="mi">0j</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s">&#39;png&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sites</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument sites not a positive integer.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">))</span> <span class="ow">or</span> <span class="n">ta</span><span class="o">.</span><span class="n">real</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument ta is not a number&#39;</span>
                            <span class="s">&#39;with a non-zero real part.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">))</span> <span class="ow">or</span> <span class="n">tb</span><span class="o">.</span><span class="n">real</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument tb is not a number&#39;</span>
                            <span class="s">&#39;with a non-zero real part.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ea</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument ea is a number.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eb</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument eb is not a number.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sites</span> <span class="o">=</span> <span class="n">sites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">=</span> <span class="n">sites</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea</span> <span class="o">=</span> <span class="n">ea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eb</span> <span class="o">=</span> <span class="n">eb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ta</span> <span class="o">=</span> <span class="n">ta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">=</span> <span class="n">tb</span>

        <span class="c"># initialize the disorder strength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dis_strength</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="c"># call a method to initialize the hoppings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_hop</span><span class="p">()</span>
        <span class="c"># call a method to initialize the onsite energies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onsite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">()</span>
        <span class="c"># initialize the positions of the sites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sites</span><span class="p">)</span>
        <span class="c"># variables dz (step) and number of steps (steps) for time evolution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dz</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_pump</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="c"># store the indices of the hopping defects,</span>
        <span class="c"># onsite energy defects, and dimerization defects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_ons_def</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_hop_def</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_dim_def</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span>
        <span class="c"># RESULTS</span>
        <span class="c"># tight-binding Hamiltonian</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ham</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="c"># eigenvalues of the Hamiltonian (eigenenergies {E_n})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="c"># squared modulus eigenvectors of the Hamiltonian {|\psi_n|^2}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="s">&#39;c16&#39;</span><span class="p">)</span>
        <span class="c"># polarization of the A sublattice ({|\psi_n^{A}|^2})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pola</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="c"># arrays containing the energy and the sum of the field intensities</span>
        <span class="c"># selected by a condition on the polarization of A sublattice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energies_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensity_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
        <span class="c"># array containing the time evolution of the field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

<div class="viewcode-block" id="chain_tb.display"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.display">[docs]</a>    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print on screen some information about the initial configuration</span>
<span class="sd">        of the tight-binding chain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;---------------------------------------&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;REPORT ON THE 1D TIGHT-BINDING MODEL&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;---------------------------------------&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;number of sites          = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;on-site energy A         = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ea</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;on-site energy B         = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eb</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;intradimer hopping ta  = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ta</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;interdimer hopping tb  = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_ons_def</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;indices of the modified onsite energies:&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_ons_def</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;index {} val {}&#39;</span>
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onsite</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_hop_def</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;indices of the modified hoppings:&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_hop_def</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;index {} val {}&#39;</span>
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_dim_def</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;indices of the dimerization defects:&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_dim_def</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;{} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="c">#######################################################</span>
<span class="c"># HOPPINGS HOPPINGS HOPPINGS HOPPINGS HOPPINGS HOPPINGS</span>
<span class="c">#######################################################</span>
</div>
<div class="viewcode-block" id="chain_tb.set_hop"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.set_hop">[docs]</a>    <span class="k">def</span> <span class="nf">set_hop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the hoppings.</span>
<span class="sd">        Used in the call of **chain_tb** to set the hoppings.</span>
<span class="sd">        </span>
<span class="sd">        :returns:</span>
<span class="sd">            * **hop** -- Hoppings of the chain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_hop_def</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_dim_def</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">hop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hop</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;c16&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="chain_tb.set_onsite"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.set_onsite">[docs]</a>    <span class="k">def</span> <span class="nf">set_onsite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the onsite energies.</span>
<span class="sd">        Used in the call of **chain_tb** to set the onsite energies.</span>
<span class="sd">        </span>
<span class="sd">        :returns:</span>
<span class="sd">            * **onsite** -- Onsite energies of the chain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_ons_def</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">onsite</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eb</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">onsite</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;c16&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="chain_tb.set_def_onsite"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.set_def_onsite">[docs]</a>    <span class="k">def</span> <span class="nf">set_def_onsite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">onsite_def</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change locally the values of the onsite energies.</span>

<span class="sd">        :param index: Array containing the indices of the sites.</span>
<span class="sd">        :param onsite_def: values of the new onsite energies.</span>

<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            # Examples</span>
<span class="sd">            ch = chain_tb(sites=21, ta=2., tb=1.)</span>
<span class="sd">            # set the 0th and 10th onsite energy to 10 and 10j:</span>
<span class="sd">            ch.set_def_onsite([0, 9], [10., 10j])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">index</span><span class="p">])</span>
            <span class="n">hop_def</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">onsite_def</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">onsite_def</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Arguments index_defect and &#39;</span>
                            <span class="s">&#39;energy_defect must have same length.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">onsite_def</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Arguments in index are not integers &#39;</span>
                                <span class="s">&#39;between 0 and (sites - 1).</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Arguments in onsite_def are not numbers.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onsite</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_ons_def</span> <span class="o">+=</span> <span class="n">index</span>
</div>
<div class="viewcode-block" id="chain_tb.set_def_hop"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.set_def_hop">[docs]</a>    <span class="k">def</span> <span class="nf">set_def_hop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">hop_def</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change locally the values of the given hoppings.</span>

<span class="sd">        :param index: Array containing the indices of the bonds.</span>
<span class="sd">        :param hop_def: values of the new hoppings.</span>

<span class="sd">        ::</span>

<span class="sd">            # Examples</span>
<span class="sd">            ch = chain_tb(stes=21, ta=2., tb=1.)</span>
<span class="sd">            # set the 0th and the 10th hoppings to 5.</span>
<span class="sd">            ch.set_def_hop([0, 9], [5., 5.])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">index</span><span class="p">])</span>
            <span class="n">hop_def</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hop_def</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hop_def</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Arguments index and onsite_def must be arrays.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hop_def</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Arguments index_defect and energy_defect &#39;</span>
                            <span class="s">&#39;must have same length.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">hop_def</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Arguments in index are not integers &#39;</span>
                                <span class="s">&#39;between 0 and (sites - 2)\.n&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Arguments in hop_def are not numbers.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_hop_def</span> <span class="o">+=</span> <span class="n">index</span>
</div>
<div class="viewcode-block" id="chain_tb.set_def_dim"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.set_def_dim">[docs]</a>    <span class="k">def</span> <span class="nf">set_def_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Introduce defects in the dimerization pattern by exchanging the </span>
<span class="sd">        intradimer hoppings with the interdimer hoppings starting</span>
<span class="sd">        from the ith site (value(s) containing in *index*).</span>
<span class="sd">        </span>
<span class="sd">        :param index: Array containing the indices of the sites.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: Dimerization defects start from the 3rd site (index = [2]).</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            # Examples</span>
<span class="sd">            ch = chain_tb(sites=11, ta=2., tb=1.)</span>
<span class="sd">            # chain with 11 sites:</span>
<span class="sd">            # A==B--A==B--A==B--A==B--A==B--A</span>
<span class="sd">            # introduce two dimerization defects</span>
<span class="sd">            ch.set_def_dim([2, 6])</span>
<span class="sd">            # the first index value 2 changes the hoppings into:</span>
<span class="sd">            # A==B--A--B==A--B==A--B==A--B==A</span>
<span class="sd">            # note that the 3rd site is now connected by two weak bonds.</span>
<span class="sd">            # The second index value 6 changes the hoppings into:</span>
<span class="sd">            # A==B--A--B==A--B==A==B--A==B--A</span>
<span class="sd">            # note that the 7th site is now connected by two strong bonds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">index</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Arguments in index are not &#39;</span>
                                <span class="s">&#39;integers between 0 and (sites - 2).</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_dim_def</span> <span class="o">+=</span> <span class="n">index</span>
    </div>
<div class="viewcode-block" id="chain_tb.set_disorder"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.set_disorder">[docs]</a>    <span class="k">def</span> <span class="nf">set_disorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strength</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Introduce uniform hopping disorder for all the hoppings.</span>
<span class="sd">        </span>
<span class="sd">        :param strength: disorder strength, hopping are between [t-strength/2: t+strength/2].</span>

<span class="sd">        .. note:: In the case of alternating couplings denoted *t_min* and *t_max*,</span>
<span class="sd">            the underlying structure of the chain can be broken if strength &gt; t_max-t_min.</span>
<span class="sd">            Weak couplings can then be larger than strong couplings.</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            # Examples</span>
<span class="sd">            ch = chain_tb(sites=21, ta=2., tb=1.)</span>
<span class="sd">            # if</span>
<span class="sd">            ch.set_disorder(.5)</span>
<span class="sd">            # disorder does not break the underlying structure of the chain.</span>
<span class="sd">            ch.set_disorder(1.)</span>
<span class="sd">            # maximal disorder of the chain without breaking its underlying structure.</span>
<span class="sd">            ch.set_disorder(2.)</span>
<span class="sd">            # breaks the underlying structure of the chain.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strength</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="n">strength</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument strength not a positive float.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dis_strength</span> <span class="o">=</span> <span class="n">strength</span>
        <span class="n">ta_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ta</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">strength</span>
        <span class="n">ta_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ta</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">strength</span>
        <span class="n">tb_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">strength</span>
        <span class="n">tb_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">strength</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;UNIFORM HOPPING DISORDER&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;ta between {:.4f} and {:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ta_min</span><span class="p">,</span> <span class="n">ta_max</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;tb between {:.4f} and {:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tb_min</span><span class="p">,</span> <span class="n">tb_max</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hop</span> <span class="o">+=</span> <span class="n">strength</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="chain_tb.reset"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the hopppings and the onsite energies to their initial values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_hop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_onsite</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_ons_def</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_hop_def</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_dim_def</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dis_strength</span> <span class="o">=</span> <span class="mf">0.</span>
    
<span class="c">######################################################</span>
<span class="c"># EIGEN EIGEN EIGEN EIGEN EIGEN EIGEN EIGEN EIGEN EIGEN</span>
<span class="c">######################################################</span>
</div>
<div class="viewcode-block" id="chain_tb.get_eig"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.get_eig">[docs]</a>    <span class="k">def</span> <span class="nf">get_eig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        Obtain the tight-binding Hamiltonian of the chain, solve the eigenvalue and</span>
<span class="sd">        eigenvector problem :math:`H|\psi_n\rangle= E_n |\psi_n\rangle`,</span>
<span class="sd">        stores the eigenenergies :math:`{E_n}`, the probability densities</span>
<span class="sd">        of the eigenstates :math:`{|\psi_n|^2}`, and the eigenvector polarizations</span>
<span class="sd">        of the A sublattice :math:`{|\psi_n^{(A)}|^2}`.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: The eigenenergies, probability densities, and A sublattice polarization,</span>
<span class="sd">            are stored in increasing order of the eigenenergies real part.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ham</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">onsite</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">en</span><span class="p">,</span> <span class="n">vn</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">=</span> <span class="n">en</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">vn</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pola</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">LA</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="chain_tb.get_intensity_selec"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.get_intensity_selec">[docs]</a>    <span class="k">def</span> <span class="nf">get_intensity_selec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s">&#39;max_pola&#39;</span><span class="p">,</span> <span class="n">val_pola</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        Get, if any, the eigenenergies and the probability densities selected</span>
<span class="sd">        through a condition on the  A sublattice polarization.</span>
<span class="sd">        </span>
<span class="sd">        :param selection: string with values &quot;max&quot;, &quot;min&quot;, &quot;larger&quot;, or &quot;smaller&quot;.</span>

<span class="sd">            * &quot;max_pola&quot; -- Default value. Stores in *energies_s* and *intensity_s*</span>
<span class="sd">              the maximal A polarized state.</span>
<span class="sd">              </span>
<span class="sd">            * &quot;min_pola&quot; -- Stores in *energies_s* and *intensity_s* the minimal</span>
<span class="sd">              A polarized state (maximal B polarized state).</span>
<span class="sd">              </span>
<span class="sd">            * &quot;larger_pola&quot; -- Stores in *energies_s* the eigenenergies of the states</span>
<span class="sd">              satisfying :math:`\langle |\psi_n^{A} |^{2} \rangle` &gt; *val_pola*,</span>
<span class="sd">              and stores in *intensity_s* the sum of the probability densities</span>
<span class="sd">              satisfying the same condition.</span>
<span class="sd">            * &quot;smaller_pola&quot; -- Stores in *energies_s* the eigenenergies of the states</span>
<span class="sd">              satisfying :math:`\langle |\psi_n^{A} |^{2} \rangle` &lt; *val_pola*,</span>
<span class="sd">              and stores in *intensity_s* the sum of the probability densities</span>
<span class="sd">              satisfying the same condition.</span>

<span class="sd">        :param val_pola: is the lower, higher bound when using the larger, </span>
<span class="sd">            smaller selection rule. Note that val_pola :math:`\in(0:1]`.</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            # Examples</span>
<span class="sd">            ch = chain_tb(sites=11, ta=1., tb=1.)</span>
<span class="sd">            ch.eig()</span>
<span class="sd">            # the eigenenergies and eigenstates are required.</span>
<span class="sd">            ch.get_intensity_selec()</span>
<span class="sd">            # finds one state of zero energies localized only on the A sublattice.</span>
<span class="sd">            ch = chain_tb(sites=10, ta=1., tb=1.)</span>
<span class="sd">            ch.eig()</span>
<span class="sd">            ch.get_intensity_selec()</span>
<span class="sd">            # finds no state.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energies_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensity_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Run the method eig() first.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val_pola</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">val_pola</span> <span class="o">&lt;=</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">val_pola</span> <span class="o">&gt;=</span> <span class="mf">1.</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument pola_a_min is not a float&#39;</span>
                            <span class="s">&#39;between 0 and 1.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="o">==</span> <span class="s">&#39;max_pola&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pola</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s">&#39;min_pola&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pola</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s">&#39;smaller_pola&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pola</span> <span class="o">&lt;</span> <span class="n">val_pola</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s">&#39;larger_pola&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pola</span> <span class="o">&gt;</span> <span class="n">val_pola</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument selection should be a string:&#39;</span>
                            <span class="s">&#39;&quot;min_pola&quot;, &quot;max_pola&quot;, &quot;smaller_pola&quot;,&#39;</span>
                            <span class="s">&#39;or &quot;larger_pola&quot;.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="s">&#39;INDEX&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;GET {} POLARIZED STATE(S):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="n">en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energies_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies_s</span><span class="p">,</span> <span class="n">en</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies_s</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s"> energies: {})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">en</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t\t</span><span class="s"> with Polarization {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pola</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intensity_s</span> <span class="o">+=</span> \
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            
<span class="c">#######################################################################</span>
<span class="c"># TIME EVOLUTION + ADIABATIC PUMPING TIME EVOLUTION + ADIABATIC PUMPING</span>
<span class="c">#######################################################################</span>
</div>
<div class="viewcode-block" id="chain_tb.get_crank"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.get_crank">[docs]</a>    <span class="k">def</span> <span class="nf">get_crank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_mat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the matrices A and B used in the Cranck-Nicolson algorithm.</span>
<span class="sd">        </span>
<span class="sd">        :param type_mat: string with values &#39;A&#39; or &#39;B&#39;.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: The *get_crank* method is essentially to be used </span>
<span class="sd">            in the method *get_propagation* and *get_pumping*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">type_mat</span> <span class="o">==</span> <span class="s">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">onsite</span> <span class="o">=</span> <span class="mi">1j</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">onsite</span>
            <span class="n">hop</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hop</span>
        <span class="k">elif</span> <span class="n">type_mat</span> <span class="o">==</span> <span class="s">&#39;B&#39;</span><span class="p">:</span>
            <span class="n">onsite</span> <span class="o">=</span> <span class="mi">1j</span> <span class="o">+</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">onsite</span>
            <span class="n">hop</span> <span class="o">=</span> <span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument type_mat is not a &#39;</span>
                            <span class="s">&#39;string with values &quot;A&quot; or &quot;B&quot;.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">([</span><span class="n">onsite</span><span class="p">,</span> <span class="n">hop</span><span class="p">,</span> <span class="n">hop</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        </div>
<div class="viewcode-block" id="chain_tb.get_propagation"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.get_propagation">[docs]</a>    <span class="k">def</span> <span class="nf">get_propagation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi_init</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">dz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        Obtain the time evolution of the field.</span>
<span class="sd">        </span>
<span class="sd">        :param psi_init: Initial state.</span>

<span class="sd">        :param dz: Default value 0.02. Step in time.</span>

<span class="sd">        :param steps: Default value 1500. Number of steps.</span>
<span class="sd">        </span>
<span class="sd">        :param norm: Default value &#39;int&#39;.</span>
<span class="sd">          Normalize the intensity at each time step:</span>
<span class="sd">        </span>
<span class="sd">            * &#39;no&#39; does not renormalize.</span>
<span class="sd">            * &#39;int&#39; renormalize according to :math:`|\psi(z)|^2=1`.</span>
<span class="sd">            * &#39;max&#39; renormalize according to :math:`\text{max}[|\psi(z)|^2]=1`.</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">        </span>
<span class="sd">            # Examples</span>
<span class="sd">            ch = chain_tb(sites=21, ta=1., tb=1., ea=0, eb=-1j)</span>
<span class="sd">            # initial state uniformly distributed on all the sites</span>
<span class="sd">            psi_i = np.ones(n)/n</span>
<span class="sd">            monomer.get_propagation(psi_i)</span>
<span class="sd">            ch = chain_tb(sites=21, ta=1., tb=1., ea=1j, eb=-1j)</span>
<span class="sd">            # initial state uniformly distributed on all the sites</span>
<span class="sd">            psi_init = np.zeros(ch.sites)</span>
<span class="sd">            psi_init[10] = 1.</span>
<span class="sd">            ch.get_propagation(psi_i)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">psi_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">psi_init</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">psi_init</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument psi_init is not &#39;</span>
                            <span class="s">&#39;of size sites.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dz</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dz</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument dz is not a positive float.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">steps</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument steps is not a positive int.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s">&#39;no&#39;</span> <span class="ow">and</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s">&#39;int&#39;</span> <span class="ow">and</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s">&#39;max&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument norm should be:&#39;</span>
                            <span class="s">&#39;&quot;no&quot;, &quot;int&quot;, or &quot;max&quot;.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dz</span> <span class="o">=</span> <span class="n">dz</span>
        <span class="n">mat_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crank</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>
        <span class="n">mat_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crank</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mat_a</span><span class="p">),</span> <span class="n">mat_b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">,</span> <span class="n">steps</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;c16&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi_init</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="chain_tb.get_pumping"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.get_pumping">[docs]</a>    <span class="k">def</span> <span class="nf">get_pumping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psi_init</span><span class="p">,</span> <span class="n">hop_new</span><span class="p">,</span> <span class="n">dz</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                    <span class="n">steps_pump</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        Obtain the time evolution of the field submitted to adiabatic</span>
<span class="sd">        modifications of the hopping configuration. The new hopping</span>
<span class="sd">        configurations are contained in the matrix hop_new.</span>
<span class="sd">        </span>
<span class="sd">        The time evolution is split in three different parts:</span>
<span class="sd">        </span>
<span class="sd">            * Stationary time evolution in the initial hopping configuration</span>
<span class="sd">              (the one of the instance of class).</span>
<span class="sd">            * Transient time evolution going linearly</span>
<span class="sd">              from the initial hopping configuration to the new one.</span>
<span class="sd">            * Stationary time evolution in the new hopping configuration.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: The last two parts of the time evolution is repeated </span>
<span class="sd">            :math:`n` times if hop_new contains :math:`n` hopping configurations.</span>

<span class="sd">        :param psi_init: Initial state.</span>
<span class="sd">        </span>
<span class="sd">        :param hop_new: List of size (sites-1, N) where N is the number of</span>
<span class="sd">            hoppings configugation.</span>
<span class="sd">        </span>
<span class="sd">        :param dz: Step in time.</span>
<span class="sd">        </span>
<span class="sd">        :param steps: Number of steps.</span>
<span class="sd">        </span>
<span class="sd">        :param steps_pump: Number of steps during the transition.</span>
<span class="sd">        </span>
<span class="sd">        :param norm: Default value &#39;int&#39;.</span>
<span class="sd">            Normalize the intensity at each time step:</span>
<span class="sd">            * &#39;no&#39;: Does not renormalize.</span>
<span class="sd">            * &#39;int&#39;: renormalize according to :math:`|\psi(z)|^2=1`.</span>
<span class="sd">            * &#39;max:&#39; renormalize according to :math:`\text{max}[|\psi(z)|^2]=1`.</span>
<span class="sd">            </span>
<span class="sd">        .. note:: The normalization, automatically performed in the Hermitian case, </span>
<span class="sd">            does not hold if *ea*, *eb*, *ta*, or *tb* are complex variables. </span>
<span class="sd">            The normalization can then be useful in presence of </span>
<span class="sd">            amplification/absorption or to plot the time evolution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">psi_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">psi_init</span><span class="p">])</span>
        <span class="n">hop_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hop_new</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dz</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dz</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument dz is not a positive float.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">steps_pump</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">steps_pump</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument steps_pump is not a positive int.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">psi_init</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument psi_init is not &#39;</span>
                            <span class="s">&#39;of size sites.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hop_new</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument hop_new is not &#39;</span>
                            <span class="s">&#39;of size sites-1.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s">&#39;no&#39;</span> <span class="ow">and</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s">&#39;int&#39;</span> <span class="ow">and</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s">&#39;max&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument norm should be &#39;</span>
                            <span class="s">&#39;&quot;no&quot;, &quot;int&quot;, or &quot;max&quot;.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="n">num_pump</span><span class="p">,</span> <span class="n">dump</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">hop_new</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">num_pump</span><span class="p">)</span><span class="o">*</span><span class="n">steps_pump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_pump</span> <span class="o">=</span> <span class="n">steps_pump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dz</span> <span class="o">=</span> <span class="n">dz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">,</span> <span class="p">(</span><span class="n">num_pump</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">steps_pump</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;c16&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi_init</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span>
        <span class="c"># Before pumping</span>
        <span class="n">hop_save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hop</span>
        <span class="n">mat_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crank</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
        <span class="n">mat_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crank</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mat_a</span><span class="p">),</span> <span class="n">mat_b</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_pump</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> \
                    <span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> \
                    <span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="c"># Pumping</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">steps_pump</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_pump</span><span class="p">):</span>
            <span class="n">hop_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hop</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="nb">range</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">steps_pump</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">steps_pump</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hop</span> <span class="o">=</span> <span class="n">trans</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">hop_new</span><span class="p">[:][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">hop_before</span><span class="p">)</span><span class="o">+</span><span class="n">hop_before</span>
                <span class="n">mat_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crank</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
                <span class="n">mat_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crank</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
                <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mat_a</span><span class="p">),</span> <span class="n">mat_b</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">val</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">val</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">val</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> \
                        <span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">val</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">val</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> \
                        <span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">val</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="c"># After pumping</span>
        <span class="n">mat_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crank</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
        <span class="n">mat_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crank</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mat_a</span><span class="p">),</span> <span class="n">mat_b</span><span class="p">)</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="nb">range</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">num_pump</span><span class="p">)</span><span class="o">*</span><span class="n">steps_pump</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">num_pump</span><span class="p">)</span><span class="o">*</span><span class="n">steps_pump</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> \
                    <span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> \
                    <span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hop</span> <span class="o">=</span> <span class="n">hop_save</span>

<span class="c">#######################################################</span>
<span class="c"># PLOTS PLOTS PLOTS PLOTS PLOTS PLOTS PLOTS PLOTS PLOTS</span>
<span class="c">#######################################################</span>
</div>
<div class="viewcode-block" id="chain_tb.plt_dispersion"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.plt_dispersion">[docs]</a>    <span class="k">def</span> <span class="nf">plt_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the dispersion relation of the infinite chain.</span>
<span class="sd">        </span>
<span class="sd">        :param lw: Default value 5. Linewidth.</span>
<span class="sd">        :param fs: Default value 20. Fontsize.</span>
<span class="sd">        :param legend: Default value True. Show legend.</span>
<span class="sd">        :param save: Default value False.</span>
<span class="sd">            Save the figure in the directory given by the method *dir_name*</span>
<span class="sd">            with name *dispersion*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ta_re</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ta</span><span class="o">.</span><span class="n">real</span>
        <span class="n">tb_re</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">real</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ta_re</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">tb_re</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">ta_re</span><span class="o">*</span><span class="n">tb_re</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="p">(</span><span class="n">ta_re</span><span class="o">+</span><span class="n">tb_re</span><span class="o">+.</span><span class="mi">2</span><span class="p">),</span> <span class="n">ta_re</span><span class="o">+</span><span class="n">tb_re</span><span class="o">+.</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s">&#39;$\pi$&#39;</span><span class="p">,</span> <span class="s">&#39;$\pi/2$&#39;</span><span class="p">,</span> <span class="s">&#39;$0$&#39;</span><span class="p">,</span> <span class="s">&#39;$\pi/2$&#39;</span><span class="p">,</span> <span class="s">&#39;$\pi$&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">pi</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">+</span><span class="n">e</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;coductive band&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="n">e</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;valence band&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;$k$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;$E(k)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;$E(k)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_fig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s">&#39;dispersion&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="chain_tb.plt_lattice"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.plt_lattice">[docs]</a>    <span class="k">def</span> <span class="nf">plt_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        Plot the lattice sites in hopping space.</span>
<span class="sd">        The A sublattice (blue circles), the B sublattice (red circles).</span>
<span class="sd">            </span>
<span class="sd">        :param ms: Default value 15. Markersize.</span>
<span class="sd">        :param coef: Default value 4. Fix the linewidths of the bonds.</span>
<span class="sd">        :param legend: Default value False. Show legend.</span>
<span class="sd">        :param save: Default value False.</span>
<span class="sd">            Save the figure in the directory given by the method *dir_name*</span>
<span class="sd">            with name *lattice*.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: if the number of sites is too large (size &gt; 50) </span>
<span class="sd">            the resulting figure will not be so useful.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="s">&#39;k&#39;</span><span class="p">,</span>
                     <span class="n">lw</span><span class="o">=</span><span class="n">coef</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39;bo&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;A&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;B&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s">&#39;Lattice&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_fig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s">&#39;lattice&#39;</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="chain_tb.plt_spec"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.plt_spec">[docs]</a>    <span class="k">def</span> <span class="nf">plt_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the spectrum. The real part (blue circles) </span>
<span class="sd">        and the polarization on the A sublattice (red circles).</span>
<span class="sd">            </span>
<span class="sd">        :param ms: Default value 10. Markersize.</span>
<span class="sd">        :param fs: Default value 20. Fontsize.</span>
<span class="sd">        :param save: Default value False. </span>
<span class="sd">            Save the figure in the directory given by the method *dir_name* </span>
<span class="sd">            with name *spec*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Run the method eig() first.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="s">&#39;ob&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;SPECTRUM AND POLARIZATION&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Spectrum and polarization&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$n$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$E_n$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="n">en_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="n">en_max</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">en_max</span><span class="o">+</span><span class="mf">0.1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pola</span><span class="p">,</span> <span class="s">&#39;or&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$&lt;A|A&gt;$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_fig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s">&#39;spec&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="chain_tb.plt_intensity_selec"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.plt_intensity_selec">[docs]</a>    <span class="k">def</span> <span class="nf">plt_intensity_selec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the sum of the sum of field intensities satisfying</span>
<span class="sd">        the condition imposed by the method get_intensity_selec.</span>
<span class="sd">            </span>
<span class="sd">        :param ms: Default value 15. Markersize.</span>
<span class="sd">        :param lw: Default value 4. Linewidth.</span>
<span class="sd">        :param fs: Default value 20. Fontsize.</span>
<span class="sd">        :param add: Default value &#39;&#39;. Give an additional file description.</span>
<span class="sd">        :param save: Default value False. Save the figure in the directory</span>
<span class="sd">            given by the method *dir_name* with name *states_selec+add*.</span>
<span class="sd">        </span>
<span class="sd">        ::</span>

<span class="sd">            # Examples</span>
<span class="sd">            ch = chain_tb(sites=20, ta=2., tb=1., ea=0j, eb=-0.5j)</span>
<span class="sd">            ch.set_def_dim([10])</span>
<span class="sd">            # The chain displays two localized states:</span>
<span class="sd">            # one mainly localized on the A sublattice, </span>
<span class="sd">            # one mainly localized on the B sublattice.</span>
<span class="sd">            ch.get_intensity_selec(&#39;max&#39;)</span>
<span class="sd">            ch.plt_intensity_selec(save=True, add=&#39;A&#39;)</span>
<span class="sd">            ch.get_intensity_selec(&#39;min&#39;)</span>
<span class="sd">            ch.plt_intensity_selec(save=True, add=&#39;B&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_s</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">x_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">x_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
            <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_s</span>
            <span class="n">int_a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">int_b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">],</span>
                          <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">+</span><span class="mf">0.05</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_a</span><span class="p">,</span> <span class="n">int_a</span><span class="p">,</span> <span class="s">&#39;-bo&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_b</span><span class="p">,</span> <span class="n">int_b</span><span class="p">,</span> <span class="s">&#39;-ro&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;POLARIZED STATE(S)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;$j$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;$|\psi_j|^2$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies_s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Selected State&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies_s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Selected States&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_fig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s">&#39;states&#39;</span><span class="o">+</span><span class="n">add</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;NO POLARIZED STATES</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="chain_tb.plt_intensity"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.plt_intensity">[docs]</a>    <span class="k">def</span> <span class="nf">plt_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used for the dimer case.</span>
<span class="sd">        Plot the intensity of both sites depending on time</span>
<span class="sd">        </span>
<span class="sd">        :param ind: Array containing the indices of the states.</span>
<span class="sd">        :param color: Array containing the colors to be plot.</span>
<span class="sd">            if color=[] intensity lines are plotted in blue</span>
<span class="sd">        :param lw: Default value 4. Linewidth.</span>
<span class="sd">        :param fs: Default value 20. Fontsize.</span>
<span class="sd">        :param save: Default value False. Save the figure in the directory</span>
<span class="sd">            given by the method *dir_name* with name *intensity*</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Run method get_propagation &#39;</span>
                            <span class="s">&#39;or pumping first.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">]</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument ind must contain &#39;</span>
                                <span class="s">&#39;integers between 0 and sites-1.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Intensity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;$z$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;$|\psi_j|^2$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_fig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s">&#39;intensity&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="chain_tb.plt_propagation"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.plt_propagation">[docs]</a>    <span class="k">def</span> <span class="nf">plt_propagation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_plt</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="n">iz_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">iz_max</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        Plot the time evolution of the intensity, the phase, or</span>
<span class="sd">        the real and imaginary parts of the field.</span>
<span class="sd">        </span>
<span class="sd">        :param type_plt: Default value &#39;int&#39;.</span>
<span class="sd">        </span>
<span class="sd">            * &#39;int&#39;, plot the intensity</span>

<span class="sd">            * &#39;field&#39;, plot the real and imag part of the field</span>

<span class="sd">            * &#39;phase&#39;, plot the phase of the field.</span>

<span class="sd">        :param iz_min:  Default value 0. Initial step of the plot</span>
<span class="sd">        :param iz_max: Default value -1. Final step of the plot.</span>
<span class="sd">            If iz_max=-1, draws up to the last last step.</span>
<span class="sd">        :param fs: Default value 20. Fontsize.</span>
<span class="sd">        :param add: Default value &#39;&#39;. Give an additional file description.</span>
<span class="sd">        :param save: Default value False.</span>
<span class="sd">            Save the figure in the directory given by the method *dir_name*</span>
<span class="sd">            with name *propagation+add*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">iz_max</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">iz_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Run method get_propagation &#39;</span>
                            <span class="s">&#39;or pumping first.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_plt</span> <span class="o">!=</span> <span class="s">&#39;int&#39;</span> <span class="ow">and</span> <span class="n">type_plt</span> <span class="o">!=</span> <span class="s">&#39;field&#39;</span> <span class="ow">and</span> <span class="n">type_plt</span> <span class="o">!=</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument type_plt must be &#39;</span>
                    <span class="s">&#39;&quot;int&quot;, &quot;field&quot;, or &quot;phase&quot;.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iz_min</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">iz_min</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">iz_min</span> <span class="o">&gt;=</span> <span class="n">iz_max</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument iz_min must be &#39;</span>
                            <span class="s">&#39;a positive integer &lt; iz_max.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iz_max</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">iz_max</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">iz_max</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument iz_max must be a positive integer&#39;</span>
                            <span class="s">&#39;smaller or egal steps.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&#39;output intensity &#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[:,</span> <span class="n">iz_max</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">iz_min</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="p">,</span> <span class="n">iz_max</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">aspect</span> <span class="o">=</span> <span class="s">&#39;auto&#39;</span>
        <span class="n">interpolation</span> <span class="o">=</span> <span class="s">&#39;nearest&#39;</span>
        <span class="k">if</span> <span class="n">type_plt</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">prop_smooth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">iz_max</span><span class="o">-</span><span class="n">iz_min</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;$|\psi(z)|^2$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">prop_smooth</span><span class="p">[:,</span> <span class="n">iz_min</span><span class="p">:</span> <span class="n">iz_max</span><span class="p">])</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prop_smooth</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span>
                            <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">))</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;3%&#39;</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_plt</span> <span class="o">==</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">prop_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">prop</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;phase $\phi$&#39;</span><span class="p">)</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prop_smooth</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span>
                            <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">))</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;3%&#39;</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s">&#39;$-\pi$&#39;</span><span class="p">,</span> <span class="s">&#39;$\pi$&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$j$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_plt</span> <span class="o">==</span> <span class="s">&#39;field&#39;</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;$\Re(\psi)$ top, $\Im(\psi)$ bottom&#39;</span><span class="p">)</span>
            <span class="n">prop_smooth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">iz_max</span><span class="o">-</span><span class="n">iz_min</span><span class="p">)</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">real</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">imag</span><span class="p">)])</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">real</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">imag</span><span class="p">)])</span>
            <span class="n">im1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prop_smooth</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span>
                             <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                             <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">))</span>
            <span class="n">divider1</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
            <span class="n">cax1</span> <span class="o">=</span> <span class="n">divider1</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;3%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax1</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s">&#39;min&#39;</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">])</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$j$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">prop_smooth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">iz_max</span><span class="o">-</span><span class="n">iz_min</span><span class="p">)</span>
            <span class="n">im2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">prop_smooth</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span>
                             <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                             <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">))</span>
            <span class="n">divider2</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
            <span class="n">cax2</span> <span class="o">=</span> <span class="n">divider2</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;3%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax2</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s">&#39;min&#39;</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">])</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$j$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;$z$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_fig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s">&#39;propagation&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="chain_tb.smooth"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.smooth">[docs]</a>    <span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">no</span><span class="o">=</span><span class="mi">40</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gaussian interpolation :math:`e^{-a(x-x_i)^2}`,</span>
<span class="sd">        (essentially used in *plt_propagation*).</span>
<span class="sd">        </span>
<span class="sd">        :param a: Default value 10. Gaussian Parameter.</span>
<span class="sd">        :param no: Default value 40. Number of points of each Gaussians.</span>
<span class="sd">        </span>
<span class="sd">        :returns:</span>
<span class="sd">            * **prop_smooth** -- Smoothed propagation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">no</span><span class="p">)</span>
        <span class="n">prop_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span> <span class="o">*</span> <span class="n">no</span><span class="p">,</span> <span class="n">steps</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">iz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">):</span>
                <span class="n">prop_smooth</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">no</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">no</span><span class="p">,</span> <span class="n">iz</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">prop</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">iz</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prop_smooth</span>
</div>
<div class="viewcode-block" id="chain_tb.plt_geometry"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.plt_geometry">[docs]</a>    <span class="k">def</span> <span class="nf">plt_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hop_new</span><span class="p">,</span> <span class="n">dz</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span> <span class="n">steps_pump</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the time dependent geometry of the lattice in hopping space. </span>
<span class="sd">        Useful for adiabatic pumping. The blue lines represent the</span>
<span class="sd">        A sublattice, the red lines the B sublattice.</span>

<span class="sd">        :param hop_new: List of size (sites-1, N) where N is the number of</span>
<span class="sd">            hoppings configugation.</span>
<span class="sd">        :param dz: Default value 0.05. Step in time.</span>
<span class="sd">        :param steps_pump: Default value 100. Number of time steps stent in</span>
<span class="sd">            one hopping configuration, and to go from one hopping configuration</span>
<span class="sd">            to the next one.</span>
<span class="sd">        :param fs: Default value 20. Fontsize.</span>
<span class="sd">        :param save: Default value False. Save the figure in the directory given </span>
<span class="sd">            by the method *dir_name* with name *geometry*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hop_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hop_new</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hop</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="k">for</span> <span class="n">hop</span> <span class="ow">in</span> <span class="n">hop_new</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Argument hop_new is not composed &#39;</span>
                            <span class="s">&#39;of size (sites-1, N).</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">hop_save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hop</span>
        <span class="n">num_pump</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hop_new</span><span class="p">)</span>
        <span class="n">steps_tot</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_pump</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">steps_pump</span>
        <span class="n">geo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">,</span> <span class="n">steps_tot</span><span class="p">))</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">steps_tot</span><span class="p">)</span>
        <span class="c"># Before pumping</span>
        <span class="n">hop_cum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
        <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">hop_cum</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">steps_pump</span><span class="p">),</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">geo</span><span class="p">[:,</span> <span class="p">:</span><span class="n">steps_pump</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">steps_pump</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
            <span class="n">geo</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="c"># Pumping</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">steps_pump</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_pump</span><span class="p">):</span>
            <span class="n">hop_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hop</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="nb">range</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">steps_pump</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">steps_pump</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hop</span> <span class="o">=</span> \
                    <span class="n">trans</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">hop_new</span><span class="p">[:][</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">hop_before</span><span class="p">)</span> <span class="o">+</span> <span class="n">hop_before</span>
                <span class="n">geo</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">,</span> <span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="c"># After pumping</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="nb">range</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">num_pump</span><span class="p">)</span><span class="o">*</span><span class="n">steps_pump</span><span class="p">,</span> <span class="n">steps_tot</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
            <span class="n">geo</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hop</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hop</span> <span class="o">=</span> <span class="n">hop_save</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;HOPPINGS TIME EVOLUTION&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">geo</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">geo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">geo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;$z$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_fig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s">&#39;geometry&#39;</span><span class="p">)</span>

                </div>
<div class="viewcode-block" id="chain_tb.plt_show"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.plt_show">[docs]</a>    <span class="k">def</span> <span class="nf">plt_show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Duplicate the matplotlib method *show* to avoid importing</span>
<span class="sd">        matplotlib to plot on screen the figures generated</span>
<span class="sd">        by the **chain_tb** class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c">############################################################</span>
<span class="c"># NAME DIRECTORY FILE NAME DIRECTORY FILE NAME DIRECTORY FILE</span>
<span class="c">############################################################</span>
</div>
<div class="viewcode-block" id="chain_tb.dir_name"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.dir_name">[docs]</a>    <span class="k">def</span> <span class="nf">dir_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of the directory, placed in &#39;./figs&#39;, in which the figures </span>
<span class="sd">        can be stored.</span>

<span class="sd">        The directory name contains the number of sites, the onsite energies </span>
<span class="sd">        and the hoppings of the A and B sublattices in complex valued</span>
<span class="sd">        notation. If sites = 20, ta=2, tb=1, ea=0, and eb=1-1j,</span>
<span class="sd">        the directory name is: n20_ta(2+0j)_tb(1+0j)_ea0j_eb(1-1j)</span>
<span class="sd">        </span>
<span class="sd">        :returns:</span>
<span class="sd">            * **dir** -- Directory name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="s">&#39;figs/n{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
        <span class="nb">dir</span> <span class="o">+=</span> <span class="s">&#39;_ta&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ta</span><span class="o">+</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="nb">dir</span> <span class="o">+=</span> <span class="s">&#39;_tb&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">+</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="nb">dir</span> <span class="o">+=</span> <span class="s">&#39;_ea&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ea</span><span class="o">+</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="nb">dir</span> <span class="o">+=</span> <span class="s">&#39;_eb&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eb</span><span class="o">+</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dir</span>
</div>
<div class="viewcode-block" id="chain_tb.check_dir"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.check_dir">[docs]</a>    <span class="k">def</span> <span class="nf">check_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the directory to store the figures exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;figs&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s">&#39;figs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="chain_tb.file_name"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.file_name">[docs]</a>    <span class="k">def</span> <span class="nf">file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the last part of the file containing: the indices of the hopping</span>
<span class="sd">        defects (if any), the indices of the onsite enery defects (if any),</span>
<span class="sd">        the indices of the dimerization defects (if any),</span>
<span class="sd">        and the extension (.png).</span>

<span class="sd">        :returns:</span>
<span class="sd">            * **name** -- Last part of the file name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_ons_def</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_onsDef&#39;</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_ons_def</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_hop_def</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_hopDef&#39;</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_hop_def</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_dim_def</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_dimDef&#39;</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_dim_def</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dis_strength</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_dis_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dis_strength</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span>
</div>
<div class="viewcode-block" id="chain_tb.save_fig"><a class="viewcode-back" href="../code.html#chain_tb.chain_tb.save_fig">[docs]</a>    <span class="k">def</span> <span class="nf">save_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&#39;fig&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the figure in the directory defined by the method *dir_name()*.</span>
<span class="sd">        Method essentially to be used by the methods *plt_*</span>

<span class="sd">        :param fig: Matplotlib fig.</span>
<span class="sd">        :param id: Default value &#39;fig&#39;. Fist part of the file describing the figure,</span>
<span class="sd">            the ids used in the class are:</span>
<span class="sd">            &#39;spectrum&#39;, &#39;spec&#39;, &#39;intensity&#39;, and &#39;propagation&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_dir</span><span class="p">()</span>
        <span class="n">name_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">id</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name_file</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Charles Poli.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>